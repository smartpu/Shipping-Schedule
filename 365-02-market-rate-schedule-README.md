# 船期与行情解析工具使用说明

## 工具简介

**船期与行情解析工具** 是一套零安装、离线运行的数据解析工具，用于将 `365-view-source` 目录下的 HTML 船期网页批量解析成 CSV 文件（可直接用 Excel 打开）。工具包含两个独立的解析器：船期解析工具和港口行情解析工具，分别用于提取船期信息和价格信息。

---

## 工具列表

### 工具 1：船期解析工具 (`365-02-schedule-parser.html`)

**功能**：自动解析明日数航船期网页，提取船期信息并导出为 CSV 文件

**主要特点**：
- 🚢 **仅解析直航**：自动过滤中转船期，只提取直航数据
- 📊 **实时预览**：解析完成后可立即预览前50条数据
- 💾 **Excel兼容**：CSV文件使用UTF-8带BOM编码，Excel可直接打开
- 🎨 **现代化界面**：全屏宽度设计，美观易用

### 工具 2：港口行情解析工具 (`365-02-market-rate-parser.html`)

**功能**：自动解析明日数航港口行情网页，提取价格信息并导出为 CSV 文件

**主要特点**：
- 💰 **价格提取**：自动提取"同航线其他港口行情"模块的价格信息
- 🔄 **自动去重**：自动合并完全相同的记录
- 📊 **实时预览**：解析完成后可立即预览前50条数据
- 💾 **Excel兼容**：CSV文件使用UTF-8带BOM编码，Excel可直接打开

---

## 前置准备

在使用解析工具之前，需要先完成以下准备工作：

1. **下载船期网页**：使用"船期网页手动下载工具"（`365-01-manual-download.html` 或 `365-01-manual-download-full.html`）下载并保存所有船期网页到 `365-view-source` 文件夹中
2. **确认文件夹**：确保 `365-view-source` 文件夹中包含需要解析的 HTML 文件
3. **浏览器要求**：建议使用最新的 Chrome 或 Edge 浏览器

---

## 工具 1：船期解析工具使用指南

### 快速开始

1. **打开工具**：双击打开 `365-02-schedule-parser.html`（或在浏览器中打开）
2. **选择文件夹**：点击"选择 view-source 文件夹"按钮，选择项目中的 `365-view-source` 目录
3. **开始解析**：点击"开始解析"按钮，等待进度完成
4. **查看结果**：预览下方会显示前 50 行样例
5. **下载 CSV**：确认解析结果无误后，点击"下载 CSV"保存全部结果

### 详细操作步骤

#### 步骤 1：打开工具

双击打开 `365-02-schedule-parser.html` 文件，会在浏览器中打开工具页面。

#### 步骤 2：选择文件夹

1. 点击"选择 view-source 文件夹"按钮
2. 在文件选择对话框中选择 `365-view-source` 文件夹
3. 选择后，工具会自动识别文件夹中的所有 HTML 文件
4. "开始解析"按钮将变为可用状态

#### 步骤 3：开始解析

1. 点击"开始解析"按钮
2. 工具会自动解析所有 HTML 文件中的船期信息
3. **重要**：仅解析"直航"船期，不包含中转船期
4. 解析过程中会显示实时日志，包括：
   - 正在解析的文件名
   - 解析到的数据条数
   - 错误或警告信息（如有）

#### 步骤 4：查看结果

1. 解析完成后，可以在下方预览表格中查看解析结果
2. 预览表格最多显示前 50 条数据
3. 可以滚动查看所有列的数据
4. 统计信息会显示总文件数、成功解析数、总数据条数等

#### 步骤 5：下载 CSV

1. 确认解析结果无误后，点击"下载 CSV"按钮
2. CSV 文件会自动下载到浏览器的默认下载文件夹
3. 文件名格式：`shipping-schedule-YYYY-MM-DD.csv`（包含当前日期）

### 输出列说明（按顺序）

CSV 文件包含以下 14 列数据：

| 序号 | 列名 | 说明 | 示例 |
|------|------|------|------|
| 1 | 启运港 | 页面顶部当前港口 | `青岛` |
| 2 | 目的港 | 页面顶部面包屑去掉前两段后，用`/`拼接 | `东南亚/新马越泰/越南/胡志明` |
| 3 | 航线ID | 每个 `.dd-notice-div` 的 `group_id` | `ROUTE001` |
| 4 | 开航日 | 开航日期 | `周一` |
| 5 | 航程(计划) | 计划航程天数 | `8天` |
| 6 | 共舱船公司 | 共舱船公司列表 | `泛洋(CVT) \| 森罗商船(CVT) \| 外运集运(CVTS)` |
| 7 | 航线备注 | 航线备注信息 | `越泰直航` 或 `越南直航` |
| 8 | 船名航次 | 船名和航次 | `POS BANGKOK/1076S` |
| 9 | 年份 | 年份信息（若有缺失则留空） | `2025` |
| 10 | 船型 | 船型信息（若有缺失则留空） | `14000 TEU` |
| 11 | 船期 | 船期日期 | `2025/11/20` |
| 12 | 启运港码头 | 启运港码头名称 | `青岛港` |
| 13 | 目的港码头 | 目的港码头名称 | `胡志明港` |
| 14 | 航程(当次) | 当次航程天数 | `8天` |

> **说明**：有的页面可能资料不完整（无年份/IMO/船型），程序会自动留空，不会中断解析。

### 解析规则要点

- **仅解析直航**：只解析包含 `.Route_list.nonstop-div` 的分组，即 `.dd-notice-div` 内含 `.Route_list.nonstop-div` 的部分
- **分组读取**：每个分组读取以下信息：
  - **分组头部**：开航日、航程(计划)、共舱船公司、航线备注
  - **分组内每条船期**：船名航次、年份/IMO/船型、船期/启运港码头/目的港码头、航程(当次)
- **数据范围**：当遇到"点击加载更多公告信息"前的所有 `li` 都会被采集

---

## 工具 2：港口行情解析工具使用指南

### 快速开始

1. **打开工具**：双击打开 `365-02-market-rate-parser.html`（或在浏览器中打开）
2. **选择文件夹**：点击"选择 view-source 文件夹"按钮，选择项目中的 `365-view-source` 目录
3. **开始解析**：点击"开始解析"按钮，工具会自动解析所有 HTML 文件中"同航线其他港口行情"模块
4. **查看结果**：预览下方会显示前 50 行样例
5. **下载 CSV**：确认解析结果无误后，点击"下载 CSV"保存全部结果

### 详细操作步骤

#### 步骤 1：打开工具

双击打开 `365-02-market-rate-parser.html` 文件，会在浏览器中打开工具页面。

#### 步骤 2：选择文件夹

1. 点击"选择 view-source 文件夹"按钮
2. 在文件选择对话框中选择 `365-view-source` 文件夹
3. 选择后，工具会自动识别文件夹中的所有 HTML 文件
4. "开始解析"按钮将变为可用状态

#### 步骤 3：开始解析

1. 点击"开始解析"按钮
2. 工具会自动解析所有 HTML 文件中"同航线其他港口行情"模块的价格信息
3. 解析过程中会显示实时日志，包括：
   - 正在解析的文件名
   - 解析到的数据条数
   - "无行情模块"提示（如果某个网页中没有行情模块）

#### 步骤 4：查看结果

1. 解析完成后，可以在下方预览表格中查看解析结果
2. 预览表格最多显示前 50 条数据
3. 可以滚动查看所有列的数据
4. 统计信息会显示总文件数、成功解析数、总数据条数等

#### 步骤 5：下载 CSV

1. 确认解析结果无误后，点击"下载 CSV"按钮
2. CSV 文件会自动下载到浏览器的默认下载文件夹
3. 文件名格式：`market-rate-YYYY-MM-DD.csv`（包含当前日期）

### 输出列说明（按顺序）

CSV 文件包含以下 6 列数据：

| 序号 | 列名 | 说明 | 示例 |
|------|------|------|------|
| 1 | 启运港 | 页面顶部当前港口 | `青岛` |
| 2 | 目的港 | 来自 `ul.Route_plugin_price li.other-price-li` 的 `title` 属性 | `胡志明` |
| 3 | 20GP | 20GP集装箱价格 | `1500` |
| 4 | 20GP涨跌 | 价格变动趋势（`+` 表示上涨，`-` 表示下跌） | `+` 或 `-` |
| 5 | 40GP | 40GP集装箱价格 | `2800` |
| 6 | 40GP涨跌 | 价格变动趋势（同上） | `+` 或 `-` |

### 解析规则要点

- **自动去重**：工具会自动合并完全相同的记录（相同启运港+目的港+20GP价格+40GP价格），只保留第一条记录
- **模块识别**：只解析包含"同航线其他港口行情"模块的网页
- **数据提取**：从 `ul.Route_plugin_price li.other-price-li` 元素中提取价格信息

---

## 工具功能对比

| 功能 | 船期解析工具 | 港口行情解析工具 |
|------|------------|----------------|
| 解析内容 | 船期信息（直航） | 价格信息（行情） |
| 输出列数 | 14 列 | 6 列 |
| 数据去重 | 否 | 是（自动去重） |
| 预览条数 | 前 50 条 | 前 50 条 |
| CSV 编码 | UTF-8 带 BOM | UTF-8 带 BOM |
| Excel 兼容 | ✅ | ✅ |

---

## 常见问题

### Q1: 解析过程中显示"无数据"或"跳过"

**A**: 可能的原因：

1. **船期解析工具**：
   - 网页中没有直航船期数据（只有中转船期）
   - 网页格式不符合预期
   - 网页数据不完整

2. **港口行情解析工具**：
   - 网页中没有"同航线其他港口行情"模块
   - 这是正常现象，不是所有网页都包含行情模块

**解决**：这是正常现象，工具会继续解析其他文件，不会中断整个解析过程。

### Q2: CSV 文件在 Excel 中打开中文乱码

**A**: 工具生成的 CSV 文件使用 UTF-8 带 BOM 编码，应该可以在 Excel 中正常打开。如果仍然出现乱码，请尝试：

1. 使用 Excel 的"数据" → "从文本/CSV"功能导入
2. 在导入时选择 UTF-8 编码
3. 或者使用其他支持 UTF-8 的软件（如 WPS、LibreOffice）打开

### Q3: 解析速度很慢

**A**: 解析速度取决于：

1. **文件数量**：文件越多，解析时间越长
2. **文件大小**：文件越大，解析时间越长
3. **浏览器性能**：建议使用 Chrome 或 Edge 浏览器

**优化建议**：
- 可以分批解析，不需要一次性解析所有文件
- 关闭其他占用资源的程序
- 使用性能较好的浏览器

### Q4: 预览表格显示不完整

**A**: 预览表格最多显示前 50 条数据，这是为了性能考虑。完整数据会包含在下载的 CSV 文件中。

### Q5: 下载的 CSV 文件在哪里？

**A**: CSV 文件会下载到浏览器的默认下载文件夹。通常位于：

- **Windows**: `C:\Users\用户名\Downloads`
- **Mac**: `~/Downloads`
- **Linux**: `~/Downloads`

可以在浏览器设置中查看或修改默认下载位置。

### Q6: 可以只解析部分文件吗？

**A**: 可以。有两种方式：

1. **临时方式**：在 `365-view-source` 文件夹中临时移动不需要解析的文件到其他位置，解析完成后再移回
2. **分批解析**：可以多次运行解析工具，每次解析不同的文件

### Q7: 解析结果不准确怎么办？

**A**: 如果发现解析结果不准确，请检查：

1. **源文件格式**：确认 HTML 文件格式是否正确
2. **网页结构**：确认网页结构是否符合工具的解析规则
3. **浏览器控制台**：按 F12 打开开发者工具，查看是否有错误信息

如果问题持续，可以：
- 检查具体的 HTML 文件内容
- 查看工具页面的日志输出
- 确认网页结构是否发生变化

### Q8: 两个工具可以同时运行吗？

**A**: 可以，但建议：

1. **分别运行**：先运行一个工具完成解析和下载，再运行另一个工具
2. **避免冲突**：同时运行可能会影响浏览器性能
3. **数据独立**：两个工具解析的数据是独立的，互不影响

---

## 技术说明

### 浏览器要求

建议使用以下浏览器的最新版本：

- **Google Chrome**（推荐）
- **Microsoft Edge**（推荐）
- Mozilla Firefox
- Safari

### 文件格式要求

- **输入格式**：HTML 文件（`.html` 或 `.htm`）
- **输出格式**：CSV 文件（UTF-8 带 BOM 编码）
- **Excel 兼容**：✅ 可直接用 Excel 打开

### 数据存储

- **所有操作在本地完成**：不会上传任何数据到服务器
- **CSV 文件**：保存在浏览器的默认下载文件夹
- **不保存解析历史**：每次运行都是全新的解析过程

### 性能说明

- **解析速度**：取决于文件数量和大小，通常每个文件 1-3 秒
- **内存占用**：解析过程中会占用一定内存，建议关闭其他占用资源的程序
- **浏览器限制**：某些浏览器可能对文件数量有限制，如果文件过多可能无法一次性选择

---

## 目录结构

```
Shipping Schedule/
├─ 365-view-source/                    ← 保存下载的网页文件
│  ├─ CNTAO-HKHKG.html
│  ├─ CNTAO-SGSIN.html
│  └─ ...
├─ 365-01-manual-download.html         ← 船期网页手动下载工具（基础版）
├─ 365-01-manual-download-full.html    ← 船期网页手动下载工具（完整版）
├─ 365-02-schedule-parser.html         ← 船期解析工具
├─ 365-02-market-rate-parser.html      ← 港口行情解析工具
├─ 365-02-market-rate-schedule-README.md  ← 本说明文档
└─ 365-04-market-watch.html            ← 市场观察分析工具
```

---

## 工作流程

### 完整工作流程

1. **第一步：下载网页**
   - 使用 `365-01-manual-download.html` 或 `365-01-manual-download-full.html` 下载船期网页
   - 保存到 `365-view-source` 文件夹

2. **第二步：解析船期数据**
   - 使用 `365-02-schedule-parser.html` 解析船期信息
   - 导出为 CSV 文件（如：`shipping-schedule-2025-11-20.csv`）

3. **第三步：解析价格数据**
   - 使用 `365-02-market-rate-parser.html` 解析价格信息
   - 导出为 CSV 文件（如：`market-rate-2025-11-20.csv`）

4. **第四步：数据整合**
   - 将解析后的 CSV 文件整合到 Excel 文件中
   - 可以使用 Excel 的数据导入功能或手动复制粘贴

5. **第五步：数据分析**
   - 使用 `365-04-market-watch.html` 进行数据分析
   - 生成市场观察报告

---

## 后续步骤

解析完成后，可以使用以下工具处理数据：

1. **数据整合**：将解析后的 CSV 文件整合到 Excel 文件中
   - 可以使用 Excel 的"数据" → "从文本/CSV"功能导入
   - 或者手动复制粘贴到 Excel 工作表中

2. **数据分析**：使用 `365-04-market-watch.html` 进行数据分析
   - 上传整合后的 Excel 文件
   - 进行运费走势分析、航线运力分析和 AI 趋势分析

3. **数据更新**：定期更新数据
   - 定期下载最新的船期网页
   - 重新解析生成最新的 CSV 文件
   - 更新到 Excel 文件中

---

## 更新日志

### 当前版本功能

- ✅ 船期解析工具：支持解析直航船期信息
- ✅ 港口行情解析工具：支持解析价格信息
- ✅ 实时预览功能：解析完成后可立即预览前50条数据
- ✅ Excel 兼容：CSV 文件使用 UTF-8 带 BOM 编码
- ✅ 现代化界面：全屏宽度设计，美观易用
- ✅ 详细日志：解析过程中显示详细的日志信息
- ✅ 自动去重：港口行情解析工具支持自动去重

---

## 技术支持

如有问题或建议，请检查：

1. **浏览器控制台**：按 F12 打开开发者工具，查看 Console 标签页的错误信息
2. **文件格式**：确认 HTML 文件格式是否正确
3. **文件夹路径**：确认 `365-view-source` 文件夹路径是否正确
4. **浏览器版本**：确认使用的是最新版本的浏览器

---

## 免责声明

本工具仅用于辅助解析本地 HTML 文件，所有操作均在本地完成，不会上传任何数据到服务器。解析的内容仅供内部使用，请遵守相关法律法规和网站使用条款。
