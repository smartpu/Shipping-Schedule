<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>明日数航 行情标准化工具使用说明</title>
    <link rel="stylesheet" href="vendor/theme-styles.css">
    <script src="vendor/auth-gist.js"></script>
</head>
<body data-page="365-03-market-port-standardizer-README.html">
    <div class="dashboard-container">
        <!-- 左侧导航栏占位容器（将由sidebar-loader.js动态加载） -->
        <div id="sidebar-placeholder"></div>

        <!-- 右侧内容 -->
        <main class="dashboard-content">
            <div class="container">
                <!-- 顶部介绍卡片，沿用 dashboard 风格 -->
                <div class="section-intro">
                    <div class="section-intro-header">
                        <div class="section-intro-content">
                            <h2>明日数航 行情标准化工具使用说明</h2>
                            <p>针对 Market 表的港口标准化工具，对启运港和目的港进行标准化，支持模糊匹配（CSV：A列=启运港，B列=目的港；Excel：B列=启运港，C列=目的港）</p>
                        </div>
                        <div class="section-intro-actions">
                            <a href="dashboard.html?tab=tools365" class="tool-link" aria-label="返回工具集首页">← 返回首页</a>
                            <a href="365-03-market-port-standardizer.html?from=tools365" class="tool-link secondary" aria-label="打开工具">打开工具 →</a>
                        </div>
                    </div>
                </div>

                <!-- 内容区域 -->
                <div class="card-white mt-20">
                    <div class="readme-content">
                        <h2>工具简介</h2>
                        <p>明日数航行情标准化工具专门针对 Market 表进行港口标准化处理，对启运港和目的港进行标准化，转换为统一格式 <code>[英文名|代码|区域]</code>。CSV 文件：A列（索引0）= 启运港，B列（索引1）= 目的港；Excel 文件：B列（索引1）= 启运港，C列（索引2）= 目的港。工具支持多种港口名称格式的识别和匹配，包括英文名、中文名、带括号的格式（如 <code>BANDAR ABBAS(阿巴斯,伊朗)</code>）、特殊格式（如 <code>KUWAIT--SHUAIBA</code>）等，并支持模糊匹配以提高匹配成功率。</p>

                        <hr>

                        <h2>使用步骤</h2>
                        <ol>
                            <li><strong>准备文件</strong>：确保已准备好包含 Market 数据的 Excel 或 CSV 文件
                                <ul>
                                    <li>CSV 文件：A列（索引0）= 启运港，B列（索引1）= 目的港</li>
                                    <li>Excel 文件：B列（索引1）= 启运港，C列（索引2）= 目的港</li>
                                </ul>
                            </li>
                            <li><strong>载入文件</strong>：
                                <ul>
                                    <li>可先选择港口列表文件（可选，推荐以获得完整映射）</li>
                                    <li>点击"载入 Market 表文件"按钮，选择要处理的文件</li>
                                </ul>
                            </li>
                            <li><strong>查看报告</strong>：处理完成后，查看转换报告了解匹配情况</li>
                            <li><strong>下载结果</strong>：点击"下载标准化后的 CSV"按钮保存处理结果</li>
                        </ol>

                        <hr>

                        <h2>核心功能</h2>
                        <ul>
                            <li>✅ <strong>Market 表专用</strong>：专门针对 Market 表格式设计
                                <ul>
                                    <li>自动识别启运港和目的港列</li>
                                    <li>如果表头中有明确的列名（如"启运港"、"目的港"），优先使用列名匹配</li>
                                    <li>如果找不到列名，使用默认索引：
                                        <ul>
                                            <li>CSV 文件：A列（索引0）= 启运港，B列（索引1）= 目的港</li>
                                            <li>Excel 文件：B列（索引1）= 启运港，C列（索引2）= 目的港</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>✅ <strong>智能匹配</strong>：支持多种港口名称格式的识别和匹配
                                <ul>
                                    <li>精确匹配：直接匹配港口名称（支持大小写不敏感）</li>
                                    <li>去除方向词：自动去除"东西南北"等方向词后匹配</li>
                                    <li>括号提取：从 <code>BANDAR ABBAS(阿巴斯,伊朗)</code> 格式中提取英文或中文部分匹配</li>
                                    <li>特殊格式处理：处理 <code>KUWAIT--SHUAIBA</code> 等特殊格式，自动转换为空格分隔</li>
                                    <li>逗号分隔：从 <code>LOS ANGELES,CA</code> 格式中提取逗号前的部分匹配</li>
                                    <li>模糊匹配：使用包含关系和相似度计算进行模糊匹配</li>
                                    <li>365 格式：支持 365 格式的港口名称（如"北美洲美西美国洛杉矶"），自动提取最后的中文部分</li>
                                </ul>
                            </li>
                            <li>✅ <strong>转换报告</strong>：生成详细的转换报告，包括：
                                <ul>
                                    <li>总体统计：显示处理的总行数</li>
                                    <li>起运港匹配情况（B列）：精确匹配、模糊匹配、未匹配的数量和列表</li>
                                    <li>目的港匹配情况（C列）：精确匹配、模糊匹配、未匹配的数量和列表</li>
                                </ul>
                            </li>
                            <li>✅ <strong>批量处理</strong>：一次性处理整个 Excel/CSV 文件的所有行</li>
                            <li>✅ <strong>Excel兼容</strong>：生成的 CSV 文件使用 UTF-8 BOM 编码，Excel 可直接打开</li>
                            <li>✅ <strong>本地支持</strong>：在本地文件系统环境下，支持手动选择港口列表文件</li>
                        </ul>

                        <hr>

                        <h2>匹配规则</h2>
                        <p>工具会按照以下优先级进行港口匹配：</p>
                        <ol>
                            <li><strong>精确匹配</strong>：直接匹配港口名称（支持大小写不敏感）</li>
                            <li><strong>去除方向词</strong>：去除"东西南北"等方向词后匹配</li>
                            <li><strong>大小写不敏感</strong>：转换为大写或小写后匹配</li>
                            <li><strong>括号提取</strong>：从 <code>BANDAR ABBAS(阿巴斯,伊朗)</code> 格式中提取英文或中文部分匹配
                                <ul>
                                    <li>优先提取括号前的英文部分</li>
                                    <li>处理特殊格式（如 <code>KUWAIT--SHUAIBA</code>），自动转换为空格分隔</li>
                                    <li>如果英文部分包含多个单词，尝试最后一个单词（通常是城市名）</li>
                                    <li>提取括号内的中文部分（逗号前）</li>
                                    <li>如果中文部分以"港"结尾，尝试去除"港"后缀后再匹配</li>
                                </ul>
                            </li>
                            <li><strong>逗号分隔</strong>：从 <code>LOS ANGELES,CA</code> 格式中提取逗号前的部分匹配</li>
                            <li><strong>365 格式提取</strong>：从 365 格式（如"北美洲美西美国洛杉矶"）中提取最后的中文部分（"洛杉矶"）进行匹配</li>
                            <li><strong>包含匹配</strong>：使用包含关系进行模糊匹配（相似度 >= 0.6）</li>
                            <li><strong>相似度匹配</strong>：计算所有键的相似度，选择最高的（相似度 >= 0.7）</li>
                        </ol>

                        <hr>

                        <h2>Market 表格式说明</h2>
                        <p>Market 表的标准格式：</p>
                        <ul>
                            <li><strong>CSV 文件</strong>：
                                <ul>
                                    <li><strong>A 列（索引0）</strong>：启运港，例如："青岛"、"上海"等</li>
                                    <li><strong>B 列（索引1）</strong>：目的港，例如：
                                        <ul>
                                            <li><code>BANDAR ABBAS(阿巴斯,伊朗)</code></li>
                                            <li><code>KUWAIT--SHUAIBA(科威特舒艾拜,科威特)</code></li>
                                            <li><code>SALALAH(塞拉莱,阿曼)</code></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li><strong>Excel 文件</strong>：
                                <ul>
                                    <li><strong>B 列（索引1）</strong>：启运港，例如："青岛"、"上海"等</li>
                                    <li><strong>C 列（索引2）</strong>：目的港，例如：
                                        <ul>
                                            <li><code>BANDAR ABBAS(阿巴斯,伊朗)</code></li>
                                            <li><code>KUWAIT--SHUAIBA(科威特舒艾拜,科威特)</code></li>
                                            <li><code>SALALAH(塞拉莱,阿曼)</code></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <p>工具会自动识别这些格式并进行标准化处理。</p>

                        <hr>

                        <h2>转换报告说明</h2>
                        <p>转换报告包含以下信息：</p>
                        <ul>
                            <li><strong>总体统计</strong>：显示处理的总行数</li>
                            <li><strong>起运港匹配情况</strong>：
                                <ul>
                                    <li>精确匹配：数量（绿色显示）</li>
                                    <li>模糊匹配：数量（黄色显示）</li>
                                    <li>未匹配：数量（红色显示）和未匹配的港口列表</li>
                                </ul>
                            </li>
                            <li><strong>目的港匹配情况</strong>：
                                <ul>
                                    <li>精确匹配：数量（绿色显示）</li>
                                    <li>模糊匹配：数量（黄色显示）</li>
                                    <li>未匹配：数量（红色显示）和未匹配的港口列表</li>
                                </ul>
                            </li>
                        </ul>

                        <hr>

                        <h2>未匹配处理</h2>
                        <p>如果出现未匹配的港口，可以：</p>
                        <ul>
                            <li>检查港口列表文件，确认港口是否在列表中</li>
                            <li>手动编辑 CSV 文件，将未匹配的港口替换为标准化格式 <code>[英文名|代码|区域]</code></li>
                            <li>联系开发人员，将新的港口添加到港口列表中</li>
                        </ul>

                        <hr>

                        <h2>注意事项</h2>
                        <ul>
                            <li>Excel/CSV 文件必须包含启运港和目的港列</li>
                            <li>如果表头中有明确的列名（如"启运港"、"目的港"），工具会优先使用列名匹配</li>
                            <li>如果找不到列名，工具会使用默认索引：
                                <ul>
                                    <li>CSV 文件：A列（索引0）= 启运港，B列（索引1）= 目的港</li>
                                    <li>Excel 文件：B列（索引1）= 启运港，C列（索引2）= 目的港</li>
                                </ul>
                            </li>
                            <li>处理大文件时可能需要一些时间，请耐心等待</li>
                            <li>下载的 CSV 文件使用 UTF-8 BOM 编码，确保 Excel 正确显示中文</li>
                            <li>在本地文件系统环境下，建议手动选择港口列表文件以获得完整的映射关系</li>
                            <li>如果未手动选择港口列表文件，工具会尝试使用已加载的数据，但可能不完整</li>
                            <li>模糊匹配的相似度阈值：包含匹配 >= 0.6，相似度匹配 >= 0.7</li>
                        </ul>

                        <hr>

                        <h2>常见问题</h2>
                        <h3>Q1: 为什么有些港口未匹配？</h3>
                        <p><strong>A</strong>：可能的原因：</p>
                        <ul>
                            <li>港口名称不在港口列表中</li>
                            <li>港口名称格式与列表中的格式差异较大，相似度低于阈值</li>
                            <li>港口名称包含特殊字符或格式</li>
                            <li>括号内的中文部分无法提取或匹配</li>
                        </ul>
                        <p>可以查看转换报告中的未匹配列表，手动处理或联系开发人员添加新的港口。</p>

                        <h3>Q2: Market 表中带括号的港口名称是如何匹配的？</h3>
                        <p><strong>A</strong>：工具会按照以下顺序尝试匹配：</p>
                        <ol>
                            <li>提取括号前的英文部分（如 <code>BANDAR ABBAS</code>）</li>
                            <li>处理特殊格式（如 <code>KUWAIT--SHUAIBA</code> 转换为 <code>KUWAIT SHUAIBA</code>）</li>
                            <li>如果英文部分包含多个单词，尝试最后一个单词（通常是城市名）</li>
                            <li>提取括号内的中文部分（逗号前，如 <code>阿巴斯</code>）</li>
                            <li>如果中文部分以"港"结尾，尝试去除"港"后缀后再匹配</li>
                        </ol>

                        <h3>Q3: 模糊匹配的相似度是如何计算的？</h3>
                        <p><strong>A</strong>：工具使用简单的相似度算法：</p>
                        <ul>
                            <li>完全匹配：相似度 = 1.0</li>
                            <li>包含匹配：相似度 = 较短字符串长度 / 较长字符串长度</li>
                            <li>字符匹配：相似度 = 公共字符数 / 较长字符串长度</li>
                        </ul>
                        <p>包含匹配的阈值 >= 0.6，相似度匹配的阈值 >= 0.7。</p>

                        <h3>Q4: 本地环境下如何获得完整的映射？</h3>
                        <p><strong>A</strong>：在本地文件系统环境下，工具会显示一个可选的港口列表文件上传区域。建议手动选择港口列表文件，这样可以获得完整的映射关系，提高匹配成功率。</p>

                        <h3>Q5: CSV 文件在 Excel 中打开中文乱码</h3>
                        <p><strong>A</strong>：工具生成的 CSV 文件使用 UTF-8 带 BOM 编码，应该可以在 Excel 中正常打开。如果仍然出现乱码，请尝试：</p>
                        <ul>
                            <li>使用 Excel 的"数据" → "从文本/CSV"功能导入</li>
                            <li>在导入时选择 UTF-8 编码</li>
                            <li>或者使用其他支持 UTF-8 的软件（如 WPS、LibreOffice）打开</li>
                        </ul>

                        <h3>Q6: 处理速度很慢</h3>
                        <p><strong>A</strong>：处理速度取决于文件大小和港口数量。如果文件很大，请耐心等待。建议使用 Chrome 或 Edge 浏览器以获得最佳性能。</p>
                    </div>
                </div>

                <!-- 使用声明 -->
                <div class="card-white mt-20">
                    <h2 class="usage-statement-title">明日数航 行情标准化工具使用声明</h2>
                    <p class="usage-statement-text">本工具专门针对 Market 表进行港口标准化，对启运港和目的港进行标准化处理，支持模糊匹配。CSV 文件：A列=启运港，B列=目的港；Excel 文件：B列=启运港，C列=目的港。工具会自动识别各种港口名称格式，包括英文名、中文名、带括号的格式等，并转换为统一格式 [英文名|代码|区域]。</p>
                    <p class="usage-statement-text">转换过程中会生成详细的转换报告，包括成功匹配、模糊匹配和未匹配的项目，便于改进代码或手动处理。</p>
                </div>
            </div>
        </main>
    </div>

    <!-- 引入导航栏公共组件 -->
    <script src="vendor/common-utils.js"></script>
    <script src="vendor/debug-utils.js"></script>
    <script src="vendor/sidebar-loader.js"></script>
    <script>
        // 初始化 365 工具页面（如果函数存在）
        if (typeof init365ToolPage === 'function') {
            init365ToolPage('365-03-market-port-standardizer-README.html', 'tools365');
        } else if (typeof init001ToolPage === 'function') {
            // 降级方案：使用 001 的初始化函数
            init001ToolPage('365-03-market-port-standardizer-README.html', 'tools365');
        }
    </script>
</body>
</html>

