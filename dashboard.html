<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Tools · 工具集</title>
    <!-- ARIA Live Region：用于动态内容更新提示（中优先级优化：ARIA 标签完善） -->
    <div id="aria-live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    <!-- 关键 CSS 内联（高优先级优化：减少首屏渲染阻塞） -->
    <style>
        /* 关键 CSS：首屏渲染必需的样式 */
        :root {
            --color-bg-primary: #F5F5F7;
            --color-bg-secondary: #FFFFFF;
            --color-text-primary: #1D1D1F;
            --color-text-secondary: #6E6E73;
            --color-brand-blue: #3E62AD;
            --color-border-light: rgba(0, 0, 0, 0.05);
            --radius-lg: 16px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            color: var(--color-text-primary);
            background-color: var(--color-bg-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            background: var(--color-bg-primary);
        }
        .dashboard-content {
            flex: 1;
            overflow-y: auto;
            background: #F6E4C8;
            padding: 24px 32px 48px;
            -webkit-overflow-scrolling: touch;
            overflow-x: hidden;
            max-width: 100vw;
            box-sizing: border-box;
            position: relative;
        }
        .tools-grid {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 28px;
            width: 100%;
            max-width: 100%;
        }
        .tool-card {
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.08);
            border: 0.5px solid var(--color-border-light);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .section-intro {
            margin-bottom: 32px;
        }
        .section-intro h2 {
            color: var(--color-text-primary);
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .section-intro p {
            color: var(--color-text-secondary);
            font-size: 15px;
            line-height: 1.6;
        }
        /* iPad横屏：显示2列 */
        @media (min-width: 1024px) and (max-width: 1400px) and (orientation: landscape) {
            .tools-grid { grid-template-columns: repeat(2, 1fr) !important; gap: 24px; }
        }
        
        /* 移动设备：工具卡片单列显示（修复手机竖屏显示3列的问题） */
        /* iPad竖屏也会被这个规则覆盖，显示单列 */
        @media (max-width: 1000px) {
            .tools-grid { grid-template-columns: 1fr !important; gap: 20px; }
            .dashboard-content { padding: 16px; }
            .section-intro { margin-bottom: 24px; }
        }
        
        /* iPad竖屏：强制单列显示 */
        @media (min-width: 768px) and (max-width: 1023px) and (orientation: portrait) {
            .tools-grid { grid-template-columns: 1fr !important; gap: 20px; }
        }
    </style>
    <!-- 预加载完整 CSS 文件 -->
    <link rel="preload" href="vendor/theme-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="vendor/theme-styles.css"></noscript>
</head>
<body data-page="dashboard.html">
    <div class="dashboard-container">
        <!-- 左侧导航栏占位容器（将由sidebar-loader.js动态加载） -->
        <div id="sidebar-placeholder"></div>
        
        <!-- 右侧内容区 -->
        <main class="dashboard-content">
            <!-- 001 系列工具 -->
            <div id="tools001" class="tab-content active">
                <div class="section-intro">
                    <h2>001 系列工具</h2>
                    <p>基于维运网（weiyun001.com）数据的船期解析与分析工具集。包含船期网页下载、船期解析和市场分析功能，适用于从维运网获取船期信息并进行深度分析。</p>
                </div>
                
                <div class="tools-grid" role="list" aria-label="001系列工具列表">
                    <div class="tool-card" role="listitem" aria-label="船期网页下载工具">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">📥</div>
                            <div class="tool-title">
                                <h3>船期网页下载工具</h3>
                                <div class="tool-id">001-01</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            从 Excel 文件加载船期数据，按起运港（POL）分组显示，支持智能排序和进度跟踪。
                        </div>
                        <div class="tool-actions">
                            <a href="001-01-manual-download.html?from=tools001" class="tool-link" aria-label="打开船期网页下载工具">打开工具 →</a>
                            <a href="001-01-manual-download-README.html" class="tool-link secondary" aria-label="查看船期网页下载工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="船期解析工具">
                        <div class="tool-header">
                            <div class="tool-icon orange" aria-hidden="true">🔍</div>
                            <div class="tool-title">
                                <h3>船期解析工具</h3>
                                <div class="tool-id">001-02</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            将维运网 HTML 船期网页批量解析成 CSV 文件。自动提取启运港、目的港、航线、船名航次、开航日期等信息，并自动去重合并。
                        </div>
                        <div class="tool-actions">
                            <a href="001-02-schedule-parser.html?from=tools001" class="tool-link" aria-label="打开船期解析工具">打开工具 →</a>
                            <a href="001-02-schedule-parser-README.html" class="tool-link secondary" aria-label="查看船期解析工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="港口标准化工具">
                        <div class="tool-header">
                            <div class="tool-icon green" aria-hidden="true">🔧</div>
                            <div class="tool-title">
                                <h3>港口标准化工具</h3>
                                <div class="tool-id">001-03</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            将 001-02 解析的 CSV 文件中的港口名称标准化为统一格式 [英文名|代码|区域]，支持模糊匹配和转换报告。
                        </div>
                        <div class="tool-actions">
                            <a href="001-03-port-standardizer.html?from=tools001" class="tool-link" aria-label="打开港口标准化工具">打开工具 →</a>
                            <a href="001-03-port-standardizer-README.html" class="tool-link secondary" aria-label="查看港口标准化工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="article" aria-label="市场分析工具">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">📊</div>
                            <div class="tool-title">
                                <h3>市场分析工具</h3>
                                <div class="tool-id">001-04</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            航线运力分析工具，支持多港口筛选、运力趋势图和派船统计。自动提取当周+未来三周数据，提供可视化分析。
                        </div>
                        <div class="tool-actions">
                            <a href="001-04-market-analysis.html?from=tools001" class="tool-link" aria-label="打开市场分析工具">打开工具 →</a>
                            <a href="001-04-market-analysis-README.html" class="tool-link secondary" aria-label="查看市场分析工具使用说明">使用说明</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 365 系列工具 -->
            <div id="tools365" class="tab-content">
                <div class="section-intro">
                    <h2>365 系列工具</h2>
                    <p>基于明日数航（hangyun365.com）数据的船期解析与分析工具集。包含船期网页下载、船期解析、航线路径解析、港口行情解析和市场观察功能，提供更全面的船期数据分析。</p>
                </div>
                
                <div class="tools-grid grid-3">
                    <div class="tool-card" role="listitem" aria-label="船期网页下载工具">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">📥</div>
                            <div class="tool-title">
                                <h3>船期网页下载工具</h3>
                                <div class="tool-id">365-01</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            从 Excel 文件加载船期数据，按起运港（POL）分组显示，支持智能排序和进度跟踪。
                        </div>
                        <div class="tool-actions">
                            <a href="365-01-manual-download.html?from=tools365" class="tool-link" aria-label="打开船期网页下载工具">打开工具 →</a>
                            <a href="365-01-manual-download-README.html" class="tool-link secondary" aria-label="查看船期网页下载工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="船期完整解析工具">
                        <div class="tool-header">
                            <div class="tool-icon orange" aria-hidden="true">🔍</div>
                            <div class="tool-title">
                                <h3>船期完整解析工具</h3>
                                <div class="tool-id">365-02</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            解析明日数航船期网页，支持 AI 船期和历史船期解析。自动去重、数据补全和日期格式转换。
                        </div>
                        <div class="tool-actions">
                            <a href="365-02-schedule-full-parser.html?from=tools365" class="tool-link" aria-label="打开船期完整解析工具">打开工具 →</a>
                            <a href="365-02-market-rate-schedule-README.html" class="tool-link secondary" aria-label="查看船期完整解析工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="航线路径解析工具">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">🗺️</div>
                            <div class="tool-title">
                                <h3>航线路径解析工具</h3>
                                <div class="tool-id">365-02</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            从船期网页中提取航线路径信息。自动解析正向路径、反向路径、中间时间，并提取航线ID和共舱船公司信息。
                        </div>
                        <div class="tool-actions">
                            <a href="365-02-rotation-parser.html?from=tools365" class="tool-link" aria-label="打开航线路径解析工具">打开工具 →</a>
                            <a href="365-02-market-rate-schedule-README.html" class="tool-link secondary" aria-label="查看航线路径解析工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="article" aria-label="港口行情解析工具">
                        <div class="tool-header">
                            <div class="tool-icon orange" aria-hidden="true">💰</div>
                            <div class="tool-title">
                                <h3>港口行情解析工具</h3>
                                <div class="tool-id">365-02</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            解析明日数航网页中的价格信息。提取各港口的 20GP/40GP 报价，支持批量解析和 CSV 导出。
                        </div>
                        <div class="tool-actions">
                            <a href="365-02-market-rate-parser.html?from=tools365" class="tool-link" aria-label="打开港口行情解析工具">打开工具 →</a>
                            <a href="365-02-market-rate-schedule-README.html" class="tool-link secondary" aria-label="查看港口行情解析工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="港口标准化工具">
                        <div class="tool-header">
                            <div class="tool-icon green" aria-hidden="true">🔧</div>
                            <div class="tool-title">
                                <h3>港口标准化工具</h3>
                                <div class="tool-id">365-03</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            将 365 格式的 Excel/CSV 文件中的港口名称（如"北美洲美西美国洛杉矶"）标准化为统一格式 [英文名|代码|区域]，支持模糊匹配和转换报告。
                        </div>
                        <div class="tool-actions">
                            <a href="365-03-port-standardizer.html?from=tools365" class="tool-link" aria-label="打开港口标准化工具">打开工具 →</a>
                            <a href="365-03-port-standardizer-README.html" class="tool-link secondary" aria-label="查看港口标准化工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="行情标准化工具">
                        <div class="tool-header">
                            <div class="tool-icon purple" aria-hidden="true">🏢</div>
                            <div class="tool-title">
                                <h3>行情标准化工具</h3>
                                <div class="tool-id">365-03</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            针对 Market 表的港口标准化工具，支持 CSV/Excel 格式自动识别列位置。提供模糊匹配和详细转换报告，确保港口名称统一标准化。
                        </div>
                        <div class="tool-actions">
                            <a href="365-03-market-port-standardizer.html?from=tools365" class="tool-link" aria-label="打开行情标准化工具">打开工具 →</a>
                            <a href="365-03-market-port-standardizer-README.html" class="tool-link secondary" aria-label="查看行情标准化工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="市场观察工具">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">📊</div>
                            <div class="tool-title">
                                <h3>市场观察工具</h3>
                                <div class="tool-id">365-04</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            综合市场分析平台，整合运费走势图、航线运力分析和 AI 趋势分析。支持多模型 AI 分析，自动抓取燃油价格和运价指数。
                        </div>
                        <div class="tool-actions">
                            <a href="365-04-market-watch.html?from=tools365" class="tool-link" aria-label="打开市场观察工具">打开工具 →</a>
                            <a href="365-04-market-watch-README.html" class="tool-link secondary" aria-label="查看市场观察工具使用说明">使用说明</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Market 系列工具 -->
            <div id="market" class="tab-content">
                <div class="section-intro">
                    <h2>Market 系列工具</h2>
                    <p>专业的市场趋势分析与船期管理工具集，支持 SCFI 历史趋势查看和专业船期表可视化。提供 Excel 数据载入、多维度筛选、大尺寸趋势图表展示、AI 智能分析等功能，便于进行市场分析和决策支持。</p>
                </div>
                
                <div class="tools-grid" role="list" aria-label="Market系列工具列表">
                    <div class="tool-card" role="listitem" aria-label="SCFI 历史趋势">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">📈</div>
                            <div class="tool-title">
                                <h3>SCFI 历史趋势</h3>
                                <div class="tool-id">Market-SCFI</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            读取 SCFI 文件，展示 B 列到 Q 列的综合指数及分 trade 指数趋势。默认显示最近3年数据，支持自定义日期范围筛选。图表高度为两倍，便于查看详细趋势。
                        </div>
                        <div class="tool-actions">
                            <a href="Market-SCFI-Trends.html?from=market" class="tool-link" aria-label="打开 SCFI 历史趋势工具">打开工具 →</a>
                            <a href="Market-SCFI-Trends-README.html" class="tool-link secondary" aria-label="查看 SCFI 历史趋势工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="article" aria-label="专业船期表">
                        <div class="tool-header">
                            <div class="tool-icon orange" aria-hidden="true">📅</div>
                            <div class="tool-title">
                                <h3>专业船期表</h3>
                                <div class="tool-id">Market-Sailing-Schedule</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            专业的船期可视化与分析工具，支持 001 和 365 两种数据模式。提供日历视图展示、多维度筛选（区域/船公司/港口）、AI 智能分析和 PDF 导出功能，帮助快速掌握船期信息。
                        </div>
                        <div class="tool-actions">
                            <a href="Market-Sailing-Schedule.html?from=market" class="tool-link" aria-label="打开专业船期表工具">打开工具 →</a>
                            <a href="Market-Sailing-Schedule-README.html" class="tool-link secondary" aria-label="查看专业船期表工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="地理贸易航线">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">🌐</div>
                            <div class="tool-title">
                                <h3>地理贸易航线</h3>
                                <div class="tool-id">Market-Geo-Trades-Service</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            地理贸易航线监控工具，支持载入 Excel 文件，通过多维度筛选（Trade、Service、Service Branding、Port Rotation）快速查找和分析服务信息。提供悬停查看详细信息功能，自动统计船舶数量。
                        </div>
                        <div class="tool-actions">
                            <a href="Market-Geo-Trades-Service.html?from=market" class="tool-link" aria-label="打开地理贸易航线工具">打开工具 →</a>
                            <a href="Market-Geo-Trades-Service-README.html" class="tool-link secondary" aria-label="查看地理贸易航线工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- Monitor 系列工具 -->
            <div id="monitor" class="tab-content">
                <div class="section-intro">
                    <h2>Monitor 系列工具</h2>
                    <p>专业的监控与分析工具集，支持运价趋势监控和每日订舱监控。提供 Excel 数据载入、多维度筛选、趋势图表展示等功能，便于进行数据监控和决策支持。</p>
                </div>
                
                <div class="tools-grid" role="list" aria-label="Monitor系列工具列表">
                    <div class="tool-card" role="listitem" aria-label="运价趋势面板">
                        <div class="tool-header">
                            <div class="tool-icon blue" aria-hidden="true">💹</div>
                            <div class="tool-title">
                                <h3>运价趋势面板</h3>
                                <div class="tool-id">Monitor-Rate-Trends</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            载入 Excel 后，用 D 列日期和 F 列港口筛选，自动抽取 G=2SD/4SH 对应的 H 列运费。支持筛选区间趋势曲线、全历史周度走势、年度对比同期观察和周度涨跌统计。
                        </div>
                        <div class="tool-actions">
                            <a href="Monitor-Rate-Trends.html?from=monitor" class="tool-link" aria-label="打开运价趋势面板工具">打开工具 →</a>
                            <a href="Monitor-Rate-Trends-README.html" class="tool-link secondary" aria-label="查看运价趋势面板工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="每日订舱监控">
                        <div class="tool-header">
                            <div class="tool-icon green" aria-hidden="true">📋</div>
                            <div class="tool-title">
                                <h3>每日订舱监控</h3>
                                <div class="tool-id">Monitor-Daily-Booking</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            每日订舱记录监控与分析工具，支持按 Trade 维度、Account 维度和 VSL/VOY 维度进行订舱情况分析。提供多维度筛选、数据统计、趋势图表、数据对比、排名分析等功能，帮助快速掌握订舱情况。
                        </div>
                        <div class="tool-actions">
                            <a href="Monitor-Daily-Booking.html?from=monitor" class="tool-link" aria-label="打开每日订舱监控工具">打开工具 →</a>
                            <a href="Monitor-Daily-Booking-README.html" class="tool-link secondary" aria-label="查看每日订舱监控工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="订舱汇总分析">
                        <div class="tool-header">
                            <div class="tool-icon orange" aria-hidden="true">📊</div>
                            <div class="tool-title">
                                <h3>订舱汇总分析</h3>
                                <div class="tool-id">Monitor-Booking-Summary</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            订舱数据多维度分析工具，支持 Sales、Account、船名航次等8个维度的深度分析。提供按部门、周别、GPS、限额等不同维度的数据分析，支持详细BL资料查看和限额管理功能。
                        </div>
                        <div class="tool-actions">
                            <a href="Monitor-Booking-Summary.html?from=monitor" class="tool-link" aria-label="打开订舱汇总分析工具">打开工具 →</a>
                            <a href="Monitor-Booking-Summary-README.html" class="tool-link secondary" aria-label="查看订舱汇总分析工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- Admin 系列工具 -->
            <div id="admin" class="tab-content">
                <div class="section-intro">
                    <h2>Admin 系列工具</h2>
                    <p>管理工具集，提供访客统计分析和代码质量保障功能。支持访问日志分析、用户行为统计、单元测试等功能，帮助了解工具使用情况和代码质量。</p>
                </div>
                
                <div class="tools-grid" role="list" aria-label="Admin系列工具列表">
                    <div class="tool-card" role="listitem" aria-label="访客统计排名">
                        <div class="tool-header">
                            <div class="tool-icon orange" aria-hidden="true">👥</div>
                            <div class="tool-title">
                                <h3>访客统计排名</h3>
                                <div class="tool-id">Admin-Access-Log</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            访客统计排名工具，自动分析访问日志数据。提供用户访问排名、页面访问排名、访问时间分析等功能，支持按小时/日期/周/月维度查看访问趋势，帮助了解工具使用情况。
                        </div>
                        <div class="tool-actions">
                            <a href="Admin-Access-Log.html?from=admin" class="tool-link" aria-label="打开访客统计排名工具">打开工具 →</a>
                            <a href="Admin-Access-Log-README.html" class="tool-link secondary" aria-label="查看访客统计排名工具使用说明">使用说明</a>
                        </div>
                    </div>
                    
                    <div class="tool-card" role="listitem" aria-label="单元测试工具">
                        <div class="tool-header">
                            <div class="tool-icon orange" aria-hidden="true">🧪</div>
                            <div class="tool-title">
                                <h3>单元测试工具</h3>
                                <div class="tool-id">tests/index</div>
                            </div>
                        </div>
                        <div class="tool-description">
                            Shipping Tools 代码质量保障工具，用于验证核心功能模块的正确性和稳定性。支持一键运行所有测试套件，实时查看测试结果，自动生成测试摘要。
                        </div>
                        <div class="tool-actions">
                            <a href="tests/index.html?from=admin" class="tool-link" aria-label="打开单元测试工具">打开工具 →</a>
                            <a href="tests/readme.html?from=admin" class="tool-link secondary" aria-label="查看单元测试工具使用说明">使用说明</a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 引入导航栏公共组件 -->
    <script src="vendor/debug-utils.js"></script>
    <script src="vendor/auth-gist.js"></script>
    <script src="vendor/sidebar-loader.js"></script>
    <!-- Toast 提示组件（中优先级优化：错误处理和反馈） -->
    <script src="vendor/toast.js"></script>
    <!-- 手势支持组件（低优先级优化：提升移动端操作效率） -->
    <script src="vendor/gesture-handler.js"></script>
    <!-- Dashboard 页面逻辑（可考虑提取到 vendor/dashboard-handler.js） -->
    <script>
        /**
         * Dashboard 页面配置
         */
        const DASHBOARD_CONFIG = {
            SECTION_MAP: {
                'tools001': '001',
                'tools365': '365',
                'market': 'Market',
                'monitor': 'Monitor',
                'admin': 'Admin'
            },
            VALID_TABS: ['tools001', 'tools365', 'market', 'monitor', 'admin']
        };

        /**
         * 切换内容区域（dashboard特定功能）
         * @param {string} tabId - 要切换的tab ID
         */
        function switchTab(tabId) {
            // 隐藏所有tab内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                // 移除可能存在的内联样式，确保CSS控制显示/隐藏
                content.style.display = '';
            });
            
            // 显示目标tab内容
            const targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
                // 确保移除内联样式，让CSS控制显示
                targetContent.style.display = '';
            }
            
            // 更新导航激活状态
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-submenu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeNavItem = document.querySelector(`.nav-item[data-section="${tabId}"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
        }

        /**
         * 展开并激活对应的导航菜单
         * @param {string} targetTab - 目标tab ID
         */
        function expandAndActivateNav(targetTab) {
            if (!DASHBOARD_CONFIG.VALID_TABS.includes(targetTab)) {
                return;
            }

            const sectionMap = DASHBOARD_CONFIG.SECTION_MAP;
            const submenuId = `submenu${sectionMap[targetTab]}`;
            const submenu = document.getElementById(submenuId);
            const navItem = document.querySelector(`.nav-item[data-section="${targetTab}"]`);
            
            if (submenu && navItem) {
                if (!submenu.classList.contains('expanded')) {
                    submenu.classList.add('expanded');
                }
                if (!navItem.classList.contains('expanded')) {
                    navItem.classList.add('expanded');
                }
                navItem.classList.add('active');
                navItem.setAttribute('aria-expanded', 'true');
            }
        }

        /**
         * 绑定导航菜单点击事件
         */
        function bindNavClickEvents() {
            document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (item.href === '#' || item.href.endsWith('#')) {
                        e.preventDefault();
                        const section = item.dataset.section;
                        switchTab(section);
                    }
                });
            });
        }

        /**
         * 等待导航栏加载完成
         * @param {Function} callback - 回调函数
         */
        function waitForSidebar(callback, maxAttempts = 10) {
            let attempts = 0;
            const checkInterval = setInterval(() => {
                attempts++;
                const sidebar = document.getElementById('sidebar');
                if (sidebar || attempts >= maxAttempts) {
                    clearInterval(checkInterval);
                    callback();
                }
            }, 50);
        }
        
        // 页面加载时初始化
        window.addEventListener('DOMContentLoaded', () => {
            // 解析URL参数
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            const targetTab = tab || 'tools001';
            
            // 检查SidebarLoader是否可用
            if (!window.SidebarLoader) {
                // 错误日志：SidebarLoader未加载，这是关键依赖
                if (typeof window.debugError === 'function') {
                    window.debugError('[Dashboard] SidebarLoader未加载');
                } else {
                    // 降级方案：如果 debugError 不可用，使用 console.error
                    if (typeof console !== 'undefined' && console.error) {
                        console.error('[Dashboard] SidebarLoader未加载');
                    }
                }
                return;
            }
            
            // 加载导航栏（dashboard页面）
            window.SidebarLoader.load('#sidebar-placeholder', {
                currentSection: targetTab,
                isDashboard: true
            });
            
            // 等待导航栏加载完成后，绑定dashboard特定的点击事件
            waitForSidebar(async () => {
                // 等待白名单加载完成后再检查权限
                if (typeof window.waitForWhitelist === 'function') {
                    await window.waitForWhitelist();
                }
                
                // 权限检查：根据权限显示/隐藏工具系列
                if (typeof window.hasPermission === 'function') {
                    // 检查各个工具系列的权限（使用异步检查，等待白名单加载）
                    const permissions = {
                        tools001: await window.hasPermission('tools001', true),
                        tools365: await window.hasPermission('tools365', true),
                        market: await window.hasPermission('market', true),
                        monitor: await window.hasPermission('monitor', true),
                        admin: await window.hasPermission('admin', true)
                    };
                    
                    // 隐藏没有权限的tab和对应的导航项
                    Object.keys(permissions).forEach(tabId => {
                        const tab = document.getElementById(tabId);
                        if (tab) {
                            if (!permissions[tabId]) {
                                tab.style.display = 'none';
                            } else {
                                tab.style.display = '';
                            }
                        }
                        
                        // 同时隐藏导航栏中对应的菜单项
                        const navItem = document.querySelector(`.nav-item[data-section="${tabId}"]`);
                        if (navItem) {
                            if (!permissions[tabId]) {
                                navItem.style.display = 'none';
                            } else {
                                navItem.style.display = '';
                            }
                        }
                    });
                    
                    // 如果当前tab没有权限，切换到第一个有权限的tab
                    if (!permissions[targetTab]) {
                        const firstValidTab = Object.keys(permissions).find(key => permissions[key]);
                        if (firstValidTab) {
                            switchTab(firstValidTab);
                            expandAndActivateNav(firstValidTab);
                            return;
                        }
                    }
                } else {
                    // 如果没有权限检查功能，至少检查admin权限（保持向后兼容）
                    const hasAdminPermission = await window.hasPermission('admin', true);
                    const adminTab = document.getElementById('admin');
                    if (!hasAdminPermission) {
                        if (adminTab) {
                            adminTab.style.display = 'none';
                        }
                        const adminNavItem = document.querySelector('.nav-item[data-section="admin"]');
                        if (adminNavItem) {
                            adminNavItem.style.display = 'none';
                        }
                        if (targetTab === 'admin') {
                            switchTab('tools001');
                            expandAndActivateNav('tools001');
                            return;
                        }
                    } else {
                        if (adminTab) {
                            adminTab.style.display = '';
                        }
                        const adminNavItem = document.querySelector('.nav-item[data-section="admin"]');
                        if (adminNavItem) {
                            adminNavItem.style.display = '';
                        }
                    }
                }
                
                // 绑定导航菜单点击事件
                bindNavClickEvents();
                
                // 切换初始tab
                if (DASHBOARD_CONFIG.VALID_TABS.includes(targetTab)) {
                    switchTab(targetTab);
                    expandAndActivateNav(targetTab);
                }
            });
        });
    </script>
</body>
</html>
